<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Using Custom Python Expression Functions (QGIS3) &#8212; QGIS Tutorials and Tips</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="search" title="Search" href="../../search.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-690672-13', 'qgistutorials.com');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');
</script>


  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/logo.png"></span>
          QGIS Tutorials and Tips</a>
        <span class="navbar-text navbar-version pull-left"><b>v1.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Tutorials List <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../making_a_map.html">Making a Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_attributes.html">Working with Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../importing_spreadsheets_csv.html">Importing Spreadsheets or CSV files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_plugins.html">Using Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../downloading_osm_data.html">Searching and Downloading OpenStreetMap Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic_vector_styling.html">Basic Vector Styling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../calculating_line_lengths.html">Calculating Line Lengths and Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../raster_styling_and_analysis.html">Basic Raster Styling and Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../raster_mosaicing_and_clipping.html">Raster Mosaicing and Clipping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_terrain.html">Working with Terrain Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_wms.html">Working with WMS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../working_with_projections.html">Working with Projections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../georeferencing_basics.html">Georeferencing Topo Sheets and Scanned Maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_georeferencing.html">Georeferencing Aerial Imagery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../digitizing_basics.html">Digitizing Map Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performing_table_joins.html">Performing Table Joins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performing_spatial_joins.html">Performing Spatial Joins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../points_in_polygon.html">Points in Polygon Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../creating_heatmaps.html">Creating Heatmaps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performing_spatial_queries.html">Performing Spatial Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nearest_neighbor_analysis.html">Nearest Neighbor Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sampling_raster_data.html">Sampling Raster Data using Points or Polygons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interpolating_point_data.html">Interpolating Point Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch_processing.html">Batch Processing using Processing Framework (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_graphical_modeler.html">Automating Complex Workflows using Processing Modeler (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="automating_map_creation.html">Automating Map Creation with Print Layout Atlas (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using_qgis_browser.html">Using the QGIS Browser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../counting_vertices.html">Counting Number of Vertices in a Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../open_bil_bip_bsq_files.html">Open BIL, BIP or BSQ files in QGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started_with_pyqgis.html">Getting Started With Python Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../building_a_python_plugin.html">Building a Python Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../custom_python_functions.html">Using Custom Python Expression Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_python_scripts.html">Writing Python Scripts for Processing Framework (QGIS3)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running_qgis_jobs.html">Running and Scheduling QGIS Processing Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../find_neighbor_polygons.html">Find Neighbor Polygons in a Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performing_table_joins_pyqgis.html">Performing Table Joins (PyQGIS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web_mapping_with_qgis2web.html">Web Mapping with QGIS2Web</a></li>
<li class="toctree-l1"><a class="reference internal" href="../creating_basemaps_with_qtiles.html">Creating Basemaps with QTiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../learning_resources.html">QGIS Learning Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits.html">Data Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../batch_processing.html">Batch Processing using Processing Framework (QGIS2)</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            

            

            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><h4>Author</h4>
<p>Ujaval Gandhi</p>
<a href="https://twitter.com/intent/follow?screen_name=spatialthoughts" class="twitter-follow-button" data-show-count="false">Follow @spatialthoughts</a>

<h4>Change Language</h4>
<form role="form" class="sidebar-form sidebar-left">
<select id="languages" class="form-control select-mini">
  <option value="en">English</option>
  <option value="zh_TW">Chinese (Taiwan)</option>
  <option value="nl">Dutch</option>
  <option value="fi_FI">Finnish</option>
  <option value="fr">French</option>
  <option value="de">German</option>
  <option value="el">Greek</option>
  <option value="id">Indonesian</option>
  <option value="it">Italian</option>
  <option value="ko">Korean</option>
  <option value="pt_BR">Portuguese</option>
  <option value="ro">Romanian</option>
  <option value="ru">Russian</option>
  <option value="sl">Slovenian</option>
  <option value="es">Spanish</option>
  <option value="th">Thai</option>
  <option value="tr">Turkish</option>
  <option value="uk">Ukrainian</option>
  <option value="vi">Vietnamese</option>
</select>
</form>



  
  <h4>Download PDF</h4> 
		
		
			
            <p>
            <a class="reference external" href="../../pdf/custom_python_functions3_a4.pdf"
             onClick="ga('send', 'event', 'PDF Download', 'custom_python_functions3_a4');"
             target="_blank">[A4]</a>
            <a class="reference external" href="../../pdf/custom_python_functions3_letter.pdf"
             onClick="ga('send', 'event', 'PDF Download', 'custom_python_functions3_letter');"
             target="_blank">[Letter]</a>
            </p>
		
  


<h4>Share</h4>
<div class="addthis_sharing_toolbox"></div>
        </div>
      </div>
    <div class="col-md-9 content">
      

  <div class="section" id="using-custom-python-expression-functions-qgis3">
<h1>Using Custom Python Expression Functions (QGIS3)<a class="headerlink" href="#using-custom-python-expression-functions-qgis3" title="Permalink to this headline">¶</a></h1>
<p>Expressions in QGIS have a lot of power and are used in many core
features -selection, calculating field values, styling, labelling etc.
QGIS also has support for user-defined expressions. With a little bit of
python programming, you can define your own functions that can be used
within the expression engine.</p>
<p>This tutorial is based on <a class="reference external" href="https://www.qgistutorials.com/en/">“QGIS Tutorials and Tips
v1.0”</a> by Ujaval Gandhi, updated
to use Python 3 and QGis 3 by Ian Turton.</p>
<div class="section" id="overview-of-the-task">
<h2>Overview of the task<a class="headerlink" href="#overview-of-the-task" title="Permalink to this headline">¶</a></h2>
<p>We will define a custom function that finds the UTM Zone of a map
feature and use this function to write an expression that displays the
UTM zone as a map tip when hovered over the point.</p>
<div class="section" id="other-skills-you-will-learn">
<h3>Other skills you will learn<a class="headerlink" href="#other-skills-you-will-learn" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>How to use the <code class="docutils literal"><span class="pre">Map</span> <span class="pre">Tips</span></code> tool to display custom text when hovering
over a feature.</li>
</ul>
</div>
</div>
<div class="section" id="get-the-data">
<h2>Get the data<a class="headerlink" href="#get-the-data" title="Permalink to this headline">¶</a></h2>
<p>We will use Natural Earth’s <a class="reference external" href="http://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-populated-places/">Populated
Places</a>
dataset. Download the <a class="reference external" href="http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_populated_places_simple.zip">simple (less columns)
dataset</a></p>
</div>
<div class="section" id="procedure">
<h2>Procedure<a class="headerlink" href="#procedure" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Open QGIS and go to Layers –&gt; Add Vector –&gt; Add Vector Layer. Or
browse to the downloaded <code class="docutils literal"><span class="pre">ne_10m_populated_places_simple.zip</span></code> file
and drag it into the map window.</p>
<img alt="../../_images/214.png" class="align-center" src="../../_images/214.png" />
</li>
<li><p class="first">Go to View –&gt; Select –&gt; Select By Expressions…. or click the
Ɛ icon:</p>
<img alt="../../_images/313.png" class="align-center" src="../../_images/313.png" />
</li>
<li><p class="first">Switch to the Function Editor tab. Here you can write any PyQGIS
code that will be executed by the expression engine.</p>
<img alt="../../_images/43.png" class="align-center" src="../../_images/43.png" />
</li>
<li><p class="first">We will define a custom function named <code class="docutils literal"><span class="pre">GetUtmZone</span></code> that will
calculate the UTM zone number for each feature. Since custom
functions in QGIS work at the feature level. We will use the
centroid of the feature’s geometry and compute the UTM Zone from the
latitude and longitude of the centroid geometry. We will also add a
‘N’ or ‘S’ designation to the zone to indicate whether the zone is
in the northern or southern hemisphere.</p>
<p>Press the <code class="docutils literal"><span class="pre">plus</span></code> button in the lower left of the screen and type
<code class="docutils literal"><span class="pre">utm_zones.py</span></code> as the file name. Then type the following code into
the editor window. When you are finished click
<code class="docutils literal"><span class="pre">Save</span> <span class="pre">and</span> <span class="pre">Load</span> <span class="pre">Functions</span></code> (on the right).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">UTM Zones are longitudinal projection zones numbered from 1 to
60. Each UTM zone is 6 degree wide. Here we use a simple
mathematical formula to find the appropriate zone for a given
longitude value. Note that this formula doesn’t cover some
special UTM zones.</p>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">qgis.core</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">qgis.gui</span> <span class="k">import</span> <span class="o">*</span>

<span class="nd">@qgsfunction</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;Custom&#39;</span><span class="p">,</span> <span class="n">usesgeometry</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">GetUtmZone</span><span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the UTM Zone of the feature&#39;s geometry as a String&quot;&quot;&quot;</span>
    <span class="n">centroid</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
    <span class="n">longitude</span> <span class="o">=</span> <span class="n">centroid</span><span class="o">.</span><span class="n">asPoint</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
    <span class="n">latitude</span> <span class="o">=</span> <span class="n">centroid</span><span class="o">.</span><span class="n">asPoint</span><span class="p">()</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>
    <span class="n">zone_number</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(((</span><span class="n">longitude</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">/</span> <span class="mi">6</span><span class="p">)</span> <span class="o">%</span> <span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">latitude</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">zone_letter</span> <span class="o">=</span> <span class="s1">&#39;N&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">zone_letter</span> <span class="o">=</span> <span class="s1">&#39;S&#39;</span>

    <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%d%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">zone_number</span><span class="p">),</span> <span class="n">zone_letter</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/53.png" class="align-center" src="../../_images/53.png" />
</li>
<li><p class="first">Switch to the Expression tab in the Select by expression dialog.
Find and expand the Custom group in the Functions section. You will
notice a new custom function <code class="docutils literal"><span class="pre">GetUtmZone</span></code> in the list. We can now
use this function in the expressions just like any other function.
Type the following expression in the editor. This expression will
select all points that fall in the UTM Zone <code class="docutils literal"><span class="pre">33N</span></code>. Click
<code class="docutils literal"><span class="pre">Zoom</span> <span class="pre">to</span> <span class="pre">Features</span></code> and the map will change, if you click
<code class="docutils literal"><span class="pre">Select</span> <span class="pre">Features</span></code> you should see the points in UTM zone 33N change
colour to yellow.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Due to an <a class="reference external" href="https://gis.stackexchange.com/questions/312782/custom-function-works-in-zoom-to-features-but-not-select-features">issue</a>
in QGIS3.4.4 this will not work! However it does work in
releases from QGIS3.4.5 and QGIS3.6.</p>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">GetUtmZone</span><span class="p">()</span> <span class="o">=</span> <span class="s1">&#39;33&#39;</span>
</pre></div>
</div>
<img alt="../../_images/5a.png" class="align-center" src="../../_images/5a.png" />
</li>
<li><p class="first">Back in the main QGIS window, you should see some points highlighted
in yellow. These are the points falling in the UTM Zone we specified
in the expression. You could also use the <code class="docutils literal"><span class="pre">Zoom</span> <span class="pre">to</span> <span class="pre">Features</span></code> button to
zoom into the selection.</p>
<img alt="../../_images/63.png" class="align-center" src="../../_images/63.png" />
</li>
<li><p class="first">You saw how we defined and used a custom function to select features
by expression. We will now use the same function in another context.
One of the hidden gems in QGIS is the <code class="docutils literal"><span class="pre">Map</span> <span class="pre">Tip</span></code> tool. This tool
shows user-defined text when you hover over a feature. Right-click
the <code class="docutils literal"><span class="pre">ne_10m_populated_places_simple</span></code> layer and select Properties.</p>
<img alt="../../_images/73.png" class="align-center" src="../../_images/73.png" />
</li>
<li><p class="first">Switch to the Display tab. Here you can enter any text that will be
displayed when you hover over the features of the layer. Even
better, you can use layer field values and expressions to define a
much more useful message. Click on the <code class="docutils literal"><span class="pre">Ɛ</span></code> button.</p>
<img alt="../../_images/93.png" class="align-center" src="../../_images/93.png" />
</li>
<li><p class="first">You will see the familiar expression editor again. We will use the
<code class="docutils literal"><span class="pre">concat</span></code> function to join the value of the field <code class="docutils literal"><span class="pre">name</span></code> and the
result of our custom function <code class="docutils literal"><span class="pre">GetUtmZone</span></code>. Enter the following
expression and click OK.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">concat</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s1">&#39;|UTM Zone: &#39;</span><span class="p">,</span><span class="n">GetUtmZone</span><span class="p">())</span>
</pre></div>
</div>
<img alt="../../_images/114.png" class="align-center" src="../../_images/114.png" />
</li>
<li><p class="first">You will see the expression entered as the value of the Display
text. Click <code class="docutils literal"><span class="pre">Insert</span></code> to add it to the HTML box and then press
<code class="docutils literal"><span class="pre">OK</span></code>.</p>
<img alt="../../_images/123.png" class="align-center" src="../../_images/123.png" />
</li>
<li><p class="first">Before we proceed, let us de-select the features that were selected
in the previous step. Go to View –&gt; Select –&gt; Deselect Features
from All Layers.</p>
<img alt="../../_images/133.png" class="align-center" src="../../_images/133.png" />
</li>
<li><p class="first">Activate the <code class="docutils literal"><span class="pre">Map</span> <span class="pre">Tips</span></code> tool by going to View –&gt; Map Tips.</p>
<img alt="../../_images/143.png" class="align-center" src="../../_images/143.png" />
</li>
<li><p class="first">Zoom into any area of the map and put your mouse cursor over any
feature. You will see the name of the city and corresponding UTM
zone displayed as the map tip.</p>
<img alt="../../_images/153.png" class="align-center" src="../../_images/153.png" />
</li>
</ol>
</div>
</div>





  <div id="disqus_thread"></div>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2016, Ujaval Gandhi.<br/>
      Last updated on Mar 07, 2019.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.7.<br/>
    </p>
  </div>
</footer>
<div class="container">
  <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/deed.en_US">Creative Commons Attribution 4.0 International License</a></p>
</div>
<!-- Twitter Button -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Disqus comments widget -->
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'qgistutorials'; // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>

<script type="text/javascript">
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=spatialthoughts" async="async"></script>

<!-- Script fpr language switching. Largely adapted from https://github.com/pcav/faunalia-website -->
<script>
    var currentPage = 'docs/3/custom_python_functions.html'; // coming from sphinx, always without starting '/'
    var currentLang = 'en';
    $(document).ready(function(){

        var search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
        var langPlusPage = window.location.href.match(search);
        // it's possible this is a index.html page called without 'index.html', try without the currentPage
        if (langPlusPage==undefined){
            search = new RegExp('\/[a-zA-Z_]{2,8}\/$', 'gi');
            langPlusPage = window.location.href.match(search);
        }

        // it's possible this is an index.html page called without 'index.html', try removing index.html
        if (langPlusPage==undefined){
            currentPage = currentPage.replace('index.html','')
            search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
            langPlusPage = window.location.href.match(search);
        }
        // still no langPlugPage: stop, because the language swicher will misbehave 

        if (langPlusPage == undefined || langPlusPage.length != 1){
            alert('You hit an error, please report back to us.');
            return;
        }
        langPlusPage = langPlusPage[0];
        currentLang = langPlusPage.replace(currentPage, '');

        $("#languages").val(currentLang.replace(/\//g,'')); // currentLang is something like '/nl/'

        $("#languages").change(function() {
            gotoLang($(this).val());
        });

    });

    // load current page in a different language
    function gotoLang(lang){
        var currentUrl = window.location.href;
        var newUrl = currentUrl.replace(currentLang, '/'+lang+'/');
        window.location.href = newUrl;
    }
</script>

  </body>
</html>