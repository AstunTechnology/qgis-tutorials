<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Python-scripts schrijven voor framework Processing &mdash; QGIS Tutorials and Tips</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.1.0/united/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="QGIS Tutorials and Tips" href="../index.html" />
    <link rel="next" title="Taken voor QGIS uitvoeren en in schema zetten" href="running_qgis_jobs.html" />
    <link rel="prev" title="Aangepaste Python expressie-functies gebruiken" href="custom_python_functions.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-690672-13', 'qgistutorials.com');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');
</script>

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><img src="../_static/logo.png">
          QGIS Tutorials and Tips</a>
        <span class="navbar-text navbar-version pull-left"><b>v1.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Tutorials List <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introductie</a></li>
<li class="toctree-l1"><a class="reference internal" href="making_a_map.html">Een kaart maken</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_attributes.html">Werken met attributen</a></li>
<li class="toctree-l1"><a class="reference internal" href="importing_spreadsheets_csv.html">Werkbladen of CSV-bestanden importeren</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_plugins.html">Plug-ins gebruiken</a></li>
<li class="toctree-l1"><a class="reference internal" href="downloading_osm_data.html">Zoeken en downloaden van gegevens van OpenStreetMap</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_vector_styling.html">Basis opmaken van vectoren</a></li>
<li class="toctree-l1"><a class="reference internal" href="calculating_line_lengths.html">Lengten van lijnen en statistieken berekenen</a></li>
<li class="toctree-l1"><a class="reference internal" href="raster_styling_and_analysis.html">Basis opmaken en analyses van rasters</a></li>
<li class="toctree-l1"><a class="reference internal" href="raster_mosaicing_and_clipping.html">Rasters mozaieken en clippen</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_terrain.html">Werken met gegevens over het terrein</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_wms.html">Werken met gegevens van WMS</a></li>
<li class="toctree-l1"><a class="reference internal" href="georeferencing_basics.html">Topobladen en gescande kaarten voorzien van geoverwijzingen</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_georeferencing.html">Geo-verwijzingen voor satellietbeelden</a></li>
<li class="toctree-l1"><a class="reference internal" href="digitizing_basics.html">Kaartgegevens digitaliseren</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_table_joins.html">Samenvoegen van tabellen uitvoeren</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_spatial_joins.html">Ruimtelijke samenvoegingen uitvoeren</a></li>
<li class="toctree-l1"><a class="reference internal" href="points_in_polygon.html">Punten in polygoon-analyses</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_heatmaps.html">Heatmaps maken</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_spatial_queries.html">Ruimtelijke query&#8217;s uitvoeren</a></li>
<li class="toctree-l1"><a class="reference internal" href="nearest_neighbor_analysis.html">Analyse Nearest Neighbor</a></li>
<li class="toctree-l1"><a class="reference internal" href="sampling_raster_data.html">Monsters nemen van rastergegevens met behulp van punten of polygonen</a></li>
<li class="toctree-l1"><a class="reference internal" href="interpolating_point_data.html">Interpoleren van puntgegevens</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch_processing.html">Massa verwerken met behulp van Framework Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing_graphical_modeler.html">Complexe werkstromen automatiseren met behulp van Grafische modellen bouwen</a></li>
<li class="toctree-l1"><a class="reference internal" href="automating_map_creation.html">Maken van kaarten automatiseren met Atlas van Printvormgeving</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_qgis_browser.html">De QGIS Browser gebruiken</a></li>
<li class="toctree-l1"><a class="reference internal" href="counting_vertices.html">Aantal punten in een laag tellen</a></li>
<li class="toctree-l1"><a class="reference internal" href="open_bil_bip_bsq_files.html">BIL-, BIP- of BSQ-bestanden openen in QGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started_with_pyqgis.html">Beginnen met programmeren in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="building_a_python_plugin.html">Een plug-in in Python bouwen</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_python_functions.html">Aangepaste Python expressie-functies gebruiken</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Python-scripts schrijven voor framework Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="running_qgis_jobs.html">Taken voor QGIS uitvoeren en in schema zetten</a></li>
<li class="toctree-l1"><a class="reference internal" href="find_neighbor_polygons.html">Naburige polygonen in een laag zoeken</a></li>
<li class="toctree-l1"><a class="reference internal" href="leaflet_maps_with_qgis2leaf.html">Kaarten op Leaflet Web met qgis2leaf</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_gme_connector.html">Google Maps Engine Connector gebruiken voor QGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="learning_resources.html">QGIS bronnen om te leren</a></li>
<li class="toctree-l1"><a class="reference internal" href="teach_qgis.html">Lesgeven in QGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Gebruik van gegevens</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="custom_python_functions.html" title="Previous Chapter: Aangepaste Python expressie-functies gebruiken"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Aangepaste Pytho...</span>
    </a>
  </li>
  <li>
    <a href="running_qgis_jobs.html" title="Next Chapter: Taken voor QGIS uitvoeren en in schema zetten"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">Taken voor QGIS ... &raquo;</span>
    </a>
  </li>
              
            
            

            
<form role="form" class="navbar-form navbar-right">
<select id="languages" class="form-control select-mini">
  <option value="en">English</option>
  <option value="nl">Dutch</option>
  <option value="fi_FI">Finnish</option>
  <option value="fr">French</option>
  <option value="de">German</option>
  <option value="el">Greek</option>
  <option value="id">Indonesian</option>
  <option value="it">Italian</option>
  <option value="ko">Korean</option>
  <option value="pt_BR">Portuguese</option>
  <option value="ro">Romanian</option>
  <option value="ru">Russian</option>
  <option value="es">Spanish</option>
</select>
</form>

            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><h4>Author</h4>
<div class="g-person" data-width="250" data-href="//plus.google.com/u/0/116912222767108657277" data-showtagline="false" data-showcoverphoto="false" data-rel="author"></div>

<h4>Share</h4>
<div class="addthis_sharing_toolbox"></div>
        </div>
      </div>
    <div class="col-md-9">
      

  <div class="section" id="writing-python-scripts-for-processing-framework">
<h1>Python-scripts schrijven voor framework Processing<a class="headerlink" href="#writing-python-scripts-for-processing-framework" title="Permalink naar deze titel">¶</a></h1>
<p>[ Download PDF <a class="reference external" href="../pdf/processing_python_scripts_a4.pdf">A4</a> <a class="reference external" href="../pdf/processing_python_scripts_letter.pdf">Letter</a> ]</p>
<p>Men kan zelfstandige scripts in Pyqgis schrijven die kunnen worden uitgevoerd in de Python Console in QGIS. Met een aantal aanpassingen kunt u uw scripts voor Pyqgis ook uitvoeren via het framework Processing. Dat heeft een aantal voordelen. Ten eerste is het invoeren van invoer door de gebruiker en het schrijven van uitvoerbestanden veel eenvoudiger omdat het framework Processing hier een gestandaardiseerde gebruikersinterface voor biedt. Ten tweede, door uw script te hebben in de Processing Toolbox kan het ook deel uitmaken van elk Model voor Processing of worden uitgevoerd als een Batch-taak met meerdere invoer. Deze handleiding zal laten zien hoe een aangepast script voor Python te schrijven dat deel kan uitmaken van het framework Processing in QGIS.</p>
<div class="section" id="overview-of-the-task">
<h2>Overzicht van de taak<a class="headerlink" href="#overview-of-the-task" title="Permalink naar deze titel">¶</a></h2>
<p>Ons script zal een bewerking voor ontbinden uitvoeren, gebaseerd op een door de gebruiker gekozen veld. Het zal ook de waarden van een ander veld bij elkaar optellen voor de ontbonden objecten. In het voorbeeld zullen we een world shapefile ontbinden, gebaseerd op een attribuut <tt class="docutils literal"><span class="pre">SUBREGION</span></tt> en het veld <tt class="docutils literal"><span class="pre">POP_EST</span></tt> optellen om de totale bevolking in de ontbonden regio te berekenen.</p>
<div class="admonition note">
<p class="first admonition-title">Notitie</p>
<p class="last">Als u zoekt naar een mogelijkheid om een bewerking Dissolve naast Statistieken uit te voeren, kunt u de excellente plug-in <tt class="docutils literal"><span class="pre">DissolveWithStats</span></tt> gebruiken. Dit script is een demonstratie van hoe een soortgelijke functionaliteit te implementeren via een script voor Processing.</p>
</div>
</div>
<div class="section" id="get-the-data">
<h2>De gegevens ophalen<a class="headerlink" href="#get-the-data" title="Permalink naar deze titel">¶</a></h2>
<p>We zullen de gegevensset <a class="reference external" href="http://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-admin-0-countries/">Admin 0 - Countries</a> van Natural Earth gebruiken.</p>
<p>Download het <a class="reference external" href="http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_admin_0_countries.zip">Admin 0 - countries shapefile.</a>.</p>
<p>Gegevensbron <a class="reference internal" href="credits.html#naturalearth" id="id1">[NATURALEARTH]</a></p>
<p>Voor het gemak kunt u direct een kopie van de gegevensset downloaden vanaf de links hieronder:</p>
<p><a class="reference external" href="../../downloads/ne_10m_admin_0_countries.zip">ne_10_admin_0_countries.zip</a></p>
</div>
<div class="section" id="procedure">
<h2>Procedure<a class="headerlink" href="#procedure" title="Permalink naar deze titel">¶</a></h2>
<ol class="arabic simple">
<li><p class="first">Open QGIS en ga naar <em class="menuselection">Kaartlagen ‣ Laag toevoegen ‣ Vectorlaag toevoegen</em>. Blader naar het gedownloade bestand <tt class="docutils literal"><span class="pre">ne_10_admin_0_countries.zip</span></tt> en laadt de laag <tt class="docutils literal"><span class="pre">ne_10_admin_0_countries</span></tt>. Ga naar <em class="menuselection">Processing ‣ Toolbox</em>.</p>
</li>
</ol>
<img alt="../_images/1107.png" class="align-center" src="../_images/1107.png" />
<ol class="arabic simple" start="2">
<li><p class="first">Vergroot de groep <em class="guilabel">Scripts</em> in de <em class="guilabel">Processing Toolbox</em> en selecteer <em class="guilabel">Nieuw script aanmaken</em>.</p>
</li>
</ol>
<img alt="../_images/250.png" class="align-center" src="../_images/250.png" />
<ol class="arabic simple" start="3">
<li><p class="first">Het begin van het script moet voldoen aan de specificaties voor invoer en uitvoer om een script voor Python te kunnen laten herkennen als een script voor Processing. Dat zal worden gebruikt om de gebruikersinterface te construeren om het script uit te voeren. U kunt meer te weten komen over de indeling van deze regels in de <a class="reference external" href="https://docs.qgis.org/2.8/en/docs/user_manual/processing/scripts.html">QGIS Processing-documentatie</a>. Voer de volgende regels in de <em class="guilabel">Script editor</em> in. Hier specificeren we 3 gebruikersinvoeren: <tt class="docutils literal"><span class="pre">dissolve_layer</span></tt>, <tt class="docutils literal"><span class="pre">dissolve_field</span></tt> en <tt class="docutils literal"><span class="pre">sum_field</span></tt>. Merk op dat we <tt class="docutils literal"><span class="pre">dissolve_layer</span></tt> toevoegen na de beide definities voor veldinvoer. Dit betekent dat de invoer vooraf zal worden gevuld met de keuze van de velden in <tt class="docutils literal"><span class="pre">dissolve_layer</span></tt>. We specificeren ook de <tt class="docutils literal"><span class="pre">output_layer</span></tt> als de uitvoer vectorlaag. Klik op de knop <em class="guilabel">Opslaan</em>.</p>
</li>
</ol>
<div class="highlight-none"><div class="highlight"><pre>##dissolve_layer=vector
##dissolve_field=field dissolve_layer
##sum_field=field dissolve_layer
##output_layer=output vector
</pre></div>
</div>
<img alt="../_images/334.png" class="align-center" src="../_images/334.png" />
<ol class="arabic simple" start="4">
<li><p class="first">Noem het script <tt class="docutils literal"><span class="pre">dissolve_with_sum</span></tt> en sla het op op de standaard locatie in de map <em class="menuselection">.qgis2 ‣ processing ‣ scripts</em>.</p>
</li>
</ol>
<img alt="../_images/424.png" class="align-center" src="../_images/424.png" />
<ol class="arabic simple" start="5">
<li><p class="first">Klik, terug in de <em class="guilabel">Script editor</em>, op de knop <em class="guilabel">Start algoritme</em> om een voorbeeld te zien van de gebruikersinterface.</p>
</li>
</ol>
<img alt="../_images/525.png" class="align-center" src="../_images/525.png" />
<ol class="arabic simple" start="6">
<li><p class="first">U ziet dat we, slechts door het toevoegen van een aantal regels, een keurige gebruikersinterface hebben om de invoer te kunnen specificeren. Het is ook consistent met alle andere algoritmes voor Processing, dus is er geen leercurve voor het gebruiken van uw eigen aangepaste algoritme.</p>
</li>
</ol>
<img alt="../_images/623.png" class="align-center" src="../_images/623.png" />
<ol class="arabic simple" start="7">
<li><p class="first">Voer, in de <em class="guilabel">Script editor</em>, de volgende code in. Het zal u opvallen dat we enkele speciale methoden gebruiken zoals <tt class="docutils literal"><span class="pre">processing.getObject()</span></tt> en <tt class="docutils literal"><span class="pre">processing.features()</span></tt>. Dit zijn wrappers voor het gemak die het eenvoudiger maken om met gegevens te werken. U kunt hier meer over te weten komen in het gedeelte <a class="reference external" href="https://docs.qgis.org/2.8/nl/docs/user_manual/processing/console.html#additional-functions-for-handling-data">Aanvullende functies voor het afhandelen van gegevens</a> van de QGIS Processing-documentatie. Klik op <em class="guilabel">Opslaan</em> om de nieuw ingevoerde code op te slaan en dan op de knop <em class="guilabel">X</em> om de bewerker te sluiten.</p>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Notitie</p>
<p class="last">Dit script gebruikt zeer veel Python samenvattingen uit lijsten. Bekijk deze <a class="reference external" href="https://docs.python.org/2/tutorial/datastructures.html#list-comprehensions">list comprehension tutorial</a> eens om bekend te geraken met de syntaxis.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">inlayer</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">dissolve_layer</span><span class="p">)</span>
<span class="n">dissolve_field_index</span> <span class="o">=</span> <span class="n">inlayer</span><span class="o">.</span><span class="n">fieldNameIndex</span><span class="p">(</span><span class="n">dissolve_field</span><span class="p">)</span>
<span class="n">sum_field_index</span> <span class="o">=</span> <span class="n">inlayer</span><span class="o">.</span><span class="n">fieldNameIndex</span><span class="p">(</span><span class="n">sum_field</span><span class="p">)</span>

<span class="c"># Find unique values present in the dissolve field</span>
<span class="n">unique_values</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="p">[</span><span class="n">dissolve_field</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span>
<span class="n">processing</span><span class="o">.</span><span class="n">features</span><span class="p">(</span><span class="n">inlayer</span><span class="p">)])</span>

<span class="k">print</span> <span class="n">unique_values</span>
</pre></div>
</div>
<img alt="../_images/723.png" class="align-center" src="../_images/723.png" />
<ol class="arabic simple" start="8">
<li><p class="first">Bij het schrijven van code is het belangrijk om de fouten te kunnen zien en uw code te kunnen debuggen. Uw scripts voor Processing kunnen eenvoudig worden gedebugd via de ingebouwde Python Console. Fa, in het hoofdvenster van QGIS, naar <em class="menuselection">Plug-ins ‣ Python Console</em>. Zoek, als de console eenmaal is geopend, naar uw script in de <em class="guilabel">Processing Toolbox</em> en dubbelklik erop om het te starten.</p>
</li>
</ol>
<img alt="../_images/822.png" class="align-center" src="../_images/822.png" />
<ol class="arabic simple" start="9">
<li><p class="first">Selecteer <tt class="docutils literal"><span class="pre">SUBREGION</span></tt> als het <em class="guilabel">dissolve field</em>. U mag elk veld kiezen als het <em class="guilabel">sum field</em> omdat het script nog geen code heeft om dat af te handelen. Klik op <em class="guilabel">Run</em>.</p>
</li>
</ol>
<img alt="../_images/920.png" class="align-center" src="../_images/920.png" />
<ol class="arabic simple" start="10">
<li><p class="first">U zult een dialoogvenster voor foutberichten zien. Dat werd verwacht omdat het script nog niet volledig is en nog geen uitvoer genereert.</p>
</li>
</ol>
<img alt="../_images/1021.png" class="align-center" src="../_images/1021.png" />
<ol class="arabic simple" start="11">
<li><p class="first">In het hoofdvenster van QGIS zult u de uitvoer voor debuggen van het script zien afgedrukt in de console. Dit is een handige manier om argumenten voor afdrukken toe te voegen en tussenliggende waarden voor variabelen te zien.</p>
</li>
</ol>
<img alt="../_images/1125.png" class="align-center" src="../_images/1125.png" />
<ol class="arabic simple" start="12">
<li><p class="first">Laten we terug gaan naar het bewerken van het script door met rechts te klikken op het script en te selecteren <em class="guilabel">Script bewerken</em>.</p>
</li>
</ol>
<img alt="../_images/1222.png" class="align-center" src="../_images/1222.png" />
<ol class="arabic simple" start="13">
<li><p class="first">Voer de volgende code in om het script te voltooien. Merk op dat we het bestaande algoritme Dissolve in QGIS gebruiken via Processing met behulp van de methode <tt class="docutils literal"><span class="pre">processing.runalg()</span></tt>.</p>
</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Create a dictionary to hold values from the sum field</span>
<span class="n">sum_unique_values</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">attributes</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">processing</span><span class="o">.</span><span class="n">features</span><span class="p">(</span><span class="n">inlayer</span><span class="p">)]</span>

<span class="k">for</span> <span class="n">unique_value</span> <span class="ow">in</span> <span class="n">unique_values</span><span class="p">:</span>
    <span class="n">val_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">f_attr</span><span class="p">[</span><span class="n">sum_field_index</span><span class="p">]</span> <span class="k">for</span> <span class="n">f_attr</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="k">if</span> <span class="n">f_attr</span><span class="p">[</span><span class="n">dissolve_field_index</span><span class="p">]</span> <span class="o">==</span> <span class="n">unique_value</span><span class="p">]</span>
    <span class="n">sum_unique_values</span><span class="p">[</span><span class="n">unique_value</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">val_list</span><span class="p">)</span>

<span class="c"># Run the regular Dissolve algorithm</span>
<span class="n">processing</span><span class="o">.</span><span class="n">runalg</span><span class="p">(</span><span class="s">&quot;qgis:dissolve&quot;</span><span class="p">,</span> <span class="n">dissolve_layer</span><span class="p">,</span> <span class="s">&quot;false&quot;</span><span class="p">,</span>
    <span class="n">dissolve_field</span><span class="p">,</span> <span class="n">output_layer</span><span class="p">)</span>

<span class="c"># Add a new attribute called &#39;SUM&#39; in the output layer</span>
<span class="n">outlayer</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">output_layer</span><span class="p">)</span>
<span class="n">provider</span> <span class="o">=</span> <span class="n">outlayer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
<span class="n">provider</span><span class="o">.</span><span class="n">addAttributes</span><span class="p">([</span><span class="n">QgsField</span><span class="p">(</span><span class="s">&#39;SUM&#39;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">)])</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>

<span class="c"># Set the value of the &#39;SUM&#39; field for each feature</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">startEditing</span><span class="p">()</span>
<span class="n">new_field_index</span> <span class="o">=</span> <span class="n">outlayer</span><span class="o">.</span><span class="n">fieldNameIndex</span><span class="p">(</span><span class="s">&#39;SUM&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">processing</span><span class="o">.</span><span class="n">features</span><span class="p">(</span><span class="n">outlayer</span><span class="p">):</span>
  <span class="n">outlayer</span><span class="o">.</span><span class="n">changeAttributeValue</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">id</span><span class="p">(),</span> <span class="n">new_field_index</span><span class="p">,</span> <span class="n">sum_unique_values</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">dissolve_field</span><span class="p">]])</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">commitChanges</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/1320.png" class="align-center" src="../_images/1320.png" />
<ol class="arabic simple" start="14">
<li><p class="first">Voer het algoritme uit door <tt class="docutils literal"><span class="pre">SUBREGION</span></tt> te selecteren als het <em class="guilabel">dissolve field</em> en <tt class="docutils literal"><span class="pre">POP_EST</span></tt> als het <em class="guilabel">sum field</em>. Klik op <em class="guilabel">Run</em>.</p>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Notitie</p>
<p class="last">Het algoritme van Processing kan tot 10 minuten nodig hebben om te voltooien, afhankelijk van uw systeem.</p>
</div>
<img alt="../_images/1419.png" class="align-center" src="../_images/1419.png" />
<ol class="arabic simple" start="15">
<li><p class="first">Als de verwerking is voltooid kunt u het gereedschap <em class="guilabel">Objecten identificeren</em> gebruiken en op een willkeurige polygoon klikken. U zult het nieuw toegevoegde veld <tt class="docutils literal"><span class="pre">SUM</span></tt> zien met de waarden van <tt class="docutils literal"><span class="pre">POP_EST</span></tt> uit alle originele polygonen bij elkaar opgeteld.</p>
</li>
</ol>
<img alt="../_images/1518.png" class="align-center" src="../_images/1518.png" />
<ol class="arabic simple" start="16">
<li><p class="first">U zult zien dat alle andere velden in de uitvoer nog steeds aanwezig zijn. Wanneer u vele objecten ontbindt om één enkel object te maken, heeft het geen zin om de originele velden in de uitvoer te behouden. Ga terug naar de <em class="guilabel">Script editor</em> en voeg de volgende toe om alle velden, met uitzondering van het veld <tt class="docutils literal"><span class="pre">SUM</span></tt> en het veld dat werd gebruikt om de originele laag te ontbinden, te verwijderen. Klik op de knop <em class="guilabel">Opslaan</em> en sluit het venster.</p>
</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Delete all fields except dissolve field and the newly created &#39;SUM&#39; field.</span>
<span class="n">olayer</span><span class="o">.</span><span class="n">startEditing</span><span class="p">()</span>

<span class="n">fields_to_delete</span> <span class="o">=</span> <span class="p">[</span><span class="n">fid</span> <span class="k">for</span> <span class="n">fid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">provider</span><span class="o">.</span><span class="n">fields</span><span class="p">()))</span> <span class="k">if</span> <span class="n">fid</span> <span class="o">!=</span> <span class="n">new_field_index</span> <span class="ow">and</span> <span class="n">fid</span> <span class="o">!=</span> <span class="n">dissolve_field_index</span><span class="p">]</span>
<span class="n">provider</span><span class="o">.</span><span class="n">deleteAttributes</span><span class="p">(</span><span class="n">fields_to_delete</span><span class="p">)</span>
<span class="n">olayer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>

<span class="n">olayer</span><span class="o">.</span><span class="n">commitChanges</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/1617.png" class="align-center" src="../_images/1617.png" />
<ol class="arabic simple" start="17">
<li><p class="first">Eén van de verborgen mogelijkheden van het framework Processing is dat alle algoritmes kunnen werken op geselecteerde objecten van een laag. Dat is enorm handig als u een algoritme wilt uitvoeren op een subset van een laag. Omdat ons script de methode <tt class="docutils literal"><span class="pre">processing.features()</span></tt> gebruikt om objecten te lezen, zal het de huidige selectie respecteren. Laten we, om dat te demonstreren, eerst een selectie maken. Klik op de knop <em class="guilabel">Selecteren van objecten gebruik makend van een expressie</em>.</p>
</li>
</ol>
<img alt="../_images/1716.png" class="align-center" src="../_images/1716.png" />
<ol class="arabic simple" start="18">
<li><p class="first">Voer de volgende expressie in om objecten te selecteren uit Noord- en Zuid-Amerika en klik op <em class="guilabel">Selecteren</em>.</p>
</li>
</ol>
<div class="highlight-none"><div class="highlight"><pre>&quot;CONTINENT&quot; = &#39;North America&#39; OR &quot;CONTINENT&quot; = &#39;South America&#39;
</pre></div>
</div>
<img alt="../_images/1816.png" class="align-center" src="../_images/1816.png" />
<ol class="arabic simple" start="19">
<li><p class="first">U zult de geselecteerde objecten zien geaccentueerd in geel. Klik met rechts op het script <tt class="docutils literal"><span class="pre">dissolve_with_sum</span></tt> en selecteer <em class="guilabel">Uitvoeren</em>.</p>
</li>
</ol>
<img alt="../_images/1914.png" class="align-center" src="../_images/1914.png" />
<ol class="arabic simple" start="20">
<li><p class="first">Selecteer de invoer zoals eerder en klik op <em class="guilabel">Run</em>.</p>
</li>
</ol>
<img alt="../_images/2011.png" class="align-center" src="../_images/2011.png" />
<ol class="arabic simple" start="22">
<li><p class="first">Een nieuwe <tt class="docutils literal"><span class="pre">output</span> <span class="pre">layer</span></tt> zal wordne toegevoegd aan QGIS. Deze zal alleen de ontbonden geometrieën bevatten uit de geselecteerde objecten van de invoerlaag. U zult ook zien dat de <tt class="docutils literal"><span class="pre">output</span> <span class="pre">layer</span></tt>, zoals verwacht, slechts 2 velden zal bevatten.</p>
</li>
</ol>
<img alt="../_images/2116.png" class="align-center" src="../_images/2116.png" />
<ol class="arabic simple" start="23">
<li><p class="first">Een laatste maar belangrijk resterend punt is om ons algoritme te documenteren. Het framework Processing heeft leuke gereedschappen om Help te schrijven en er toegang tot te verkrijgen. Ga naar de <em class="guilabel">Script editor</em> en klik op de knop <em class="guilabel">Help-script bewerken</em>.</p>
</li>
</ol>
<img alt="../_images/2215.png" class="align-center" src="../_images/2215.png" />
<ol class="arabic simple" start="24">
<li><p class="first">Vul de details in voor de verschillende elementen en klik op <em class="guilabel">OK</em>. Nu zal een gedetailleerde Help beschikbaar zijn voor alle gebruikers van uw script op de tab <em class="guilabel">Help</em> als zij het algoritme starten.</p>
</li>
</ol>
<img alt="../_images/2312.png" class="align-center" src="../_images/2312.png" />
<p>Hieronder staat het volledige script als verwijzing. U kunt het aanpassen zodat het aan uw eigen wensen voldoet.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">##dissolve_layer=vector</span>
<span class="c">##dissolve_field=field dissolve_layer</span>
<span class="c">##sum_field=field dissolve_layer</span>
<span class="c">##output_layer=output vector</span>

<span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">inlayer</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">dissolve_layer</span><span class="p">)</span>
<span class="n">dissolve_field_index</span> <span class="o">=</span> <span class="n">inlayer</span><span class="o">.</span><span class="n">fieldNameIndex</span><span class="p">(</span><span class="n">dissolve_field</span><span class="p">)</span>
<span class="n">sum_field_index</span> <span class="o">=</span> <span class="n">inlayer</span><span class="o">.</span><span class="n">fieldNameIndex</span><span class="p">(</span><span class="n">sum_field</span><span class="p">)</span>

<span class="c"># Find unique values present in the dissolve field</span>
<span class="n">unique_values</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="p">[</span><span class="n">dissolve_field</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">processing</span><span class="o">.</span><span class="n">features</span><span class="p">(</span><span class="n">inlayer</span><span class="p">)])</span>

<span class="c"># Create a dictionary to hold values from the sum field</span>
<span class="n">sum_unique_values</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">attributes</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">processing</span><span class="o">.</span><span class="n">features</span><span class="p">(</span><span class="n">inlayer</span><span class="p">)]</span>
 
<span class="k">for</span> <span class="n">unique_value</span> <span class="ow">in</span> <span class="n">unique_values</span><span class="p">:</span>
    <span class="n">val_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">f_attr</span><span class="p">[</span><span class="n">sum_field_index</span><span class="p">]</span> <span class="k">for</span> <span class="n">f_attr</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="k">if</span> <span class="n">f_attr</span><span class="p">[</span><span class="n">dissolve_field_index</span><span class="p">]</span> <span class="o">==</span> <span class="n">unique_value</span><span class="p">]</span>
    <span class="n">sum_unique_values</span><span class="p">[</span><span class="n">unique_value</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">val_list</span><span class="p">)</span>

<span class="c"># Run the regular Dissolve algorithm</span>
<span class="n">processing</span><span class="o">.</span><span class="n">runalg</span><span class="p">(</span><span class="s">&quot;qgis:dissolve&quot;</span><span class="p">,</span> <span class="n">dissolve_layer</span><span class="p">,</span> <span class="s">&quot;false&quot;</span><span class="p">,</span>
    <span class="n">dissolve_field</span><span class="p">,</span> <span class="n">output_layer</span><span class="p">)</span>

<span class="c"># Add a new attribute called &#39;SUM&#39; in the output layer</span>
<span class="n">outlayer</span> <span class="o">=</span> <span class="n">processing</span><span class="o">.</span><span class="n">getObject</span><span class="p">(</span><span class="n">output_layer</span><span class="p">)</span>
<span class="n">provider</span> <span class="o">=</span> <span class="n">outlayer</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
<span class="n">provider</span><span class="o">.</span><span class="n">addAttributes</span><span class="p">([</span><span class="n">QgsField</span><span class="p">(</span><span class="s">&#39;SUM&#39;</span><span class="p">,</span> <span class="n">QVariant</span><span class="o">.</span><span class="n">Double</span><span class="p">)])</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>

<span class="c"># Set the value of the &#39;SUM&#39; field for each feature</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">startEditing</span><span class="p">()</span>
<span class="n">new_field_index</span> <span class="o">=</span> <span class="n">outlayer</span><span class="o">.</span><span class="n">fieldNameIndex</span><span class="p">(</span><span class="s">&#39;SUM&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">processing</span><span class="o">.</span><span class="n">features</span><span class="p">(</span><span class="n">outlayer</span><span class="p">):</span>
  <span class="n">outlayer</span><span class="o">.</span><span class="n">changeAttributeValue</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">id</span><span class="p">(),</span> <span class="n">new_field_index</span><span class="p">,</span> <span class="n">sum_unique_values</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">dissolve_field</span><span class="p">]])</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">commitChanges</span><span class="p">()</span>

<span class="c"># Delete all fields except dissolve field and the newly created &#39;SUM&#39; field</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">startEditing</span><span class="p">()</span>
<span class="n">fields_to_delete</span> <span class="o">=</span> <span class="p">[</span><span class="n">fid</span> <span class="k">for</span> <span class="n">fid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">provider</span><span class="o">.</span><span class="n">fields</span><span class="p">()))</span> <span class="k">if</span> <span class="n">fid</span> <span class="o">!=</span> <span class="n">new_field_index</span> <span class="ow">and</span> <span class="n">fid</span> <span class="o">!=</span> <span class="n">dissolve_field_index</span><span class="p">]</span>
<span class="n">provider</span><span class="o">.</span><span class="n">deleteAttributes</span><span class="p">(</span><span class="n">fields_to_delete</span><span class="p">)</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">updateFields</span><span class="p">()</span>
<span class="n">outlayer</span><span class="o">.</span><span class="n">commitChanges</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>





  <div id="disqus_thread"></div>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2015, Ujaval Gandhi.<br/>
      Laatste aanpassing op Sep 16, 2015.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2.<br/>
    </p>
  </div>
</footer>
<!-- Google+ Badge -->
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>

<!-- Disqus comments widget -->
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'qgistutorials'; // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>

<script type="text/javascript">
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=spatialthoughts" async="async"></script>

<!-- Script fpr language switching. Largely adapted from https://github.com/pcav/faunalia-website -->
<script>
    var currentPage = 'docs/processing_python_scripts.html'; // coming from sphinx, always without starting '/'
    var currentLang = 'en';
    $(document).ready(function(){

        var search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
        var langPlusPage = window.location.href.match(search);
        // it's possible this is a index.html page called without 'index.html', try without the currentPage
        if (langPlusPage==undefined){
            search = new RegExp('\/[a-zA-Z_]{2,8}\/$', 'gi');
            langPlusPage = window.location.href.match(search);
        }

        // it's possible this is an index.html page called without 'index.html', try removing index.html
        if (langPlusPage==undefined){
            currentPage = currentPage.replace('index.html','')
            search = new RegExp('\/[a-zA-Z_]{2,8}\/'+ currentPage, 'gi');
            langPlusPage = window.location.href.match(search);
        }
        // still no langPlugPage: stop, because the language swicher will misbehave 

        if (langPlusPage == undefined || langPlusPage.length != 1){
            alert('You hit an error, please report back to us.');
            return;
        }
        langPlusPage = langPlusPage[0];
        currentLang = langPlusPage.replace(currentPage, '');

        $("#languages").val(currentLang.replace(/\//g,'')); // currentLang is something like '/nl/'

        $("#languages").change(function() {
            gotoLang($(this).val());
        });

    });

    // load current page in a different language
    function gotoLang(lang){
        var currentUrl = window.location.href;
        var newUrl = currentUrl.replace(currentLang, '/'+lang+'/');
        window.location.href = newUrl;
    }
</script>

  </body>
</html>