<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Nearest Neighbor Analysis &mdash; QGIS Tutorials and Tips</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.1.0/united/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="QGIS Tutorials and Tips" href="../index.html" />
    <link rel="next" title="Batch Processing using Processing Framework" href="batch_processing.html" />
    <link rel="prev" title="Performing Spatial Queries" href="performing_spatial_queries.html" />

<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-690672-13', 'qgistutorials.com');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');
</script>

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          QGIS Tutorials and Tips</a>
        <span class="navbar-text navbar-version pull-left"><b>v1.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Tutorials List <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="making_a_map.html">Making a Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_attributes.html">Working with Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="importing_spreadsheets_csv.html">Importing Spreadsheets or CSV files</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_plugins.html">Using Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="downloading_osm_data.html">Searching and Downloading OpenStreetMap Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_vector_styling.html">Basic Vector Styling</a></li>
<li class="toctree-l1"><a class="reference internal" href="calculating_line_lengths.html">Calculating Line Lengths and Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="raster_styling_and_analysis.html">Basic Raster Styling and Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="raster_mosaicing_and_clipping.html">Raster Mosaicing and Clipping</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_terrain.html">Working with Terrain Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="working_with_wms.html">Working with WMS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="georeferencing_basics.html">Georeferencing Topo Sheets and Scanned Maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_georeferencing.html">Georeferencing Aerial Imagery</a></li>
<li class="toctree-l1"><a class="reference internal" href="digitizing_basics.html">Digitizing Map Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_table_joins.html">Performing Table Joins</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_spatial_joins.html">Performing Spatial Joins</a></li>
<li class="toctree-l1"><a class="reference internal" href="points_in_polygon.html">Points in Polygon Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_heatmaps.html">Creating Heatmaps</a></li>
<li class="toctree-l1"><a class="reference internal" href="performing_spatial_queries.html">Performing Spatial Queries</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Nearest Neighbor Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="batch_processing.html">Batch Processing using Processing Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="counting_vertices.html">Counting Number of Vertices in a Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="open_bil_bip_bsq_files.html">Open BIL, BIP or BSQ files in QGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started_with_pyqgis.html">Getting Started With Python Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="find_neighbor_polygons.html">Find Neighbor Polygons in a Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="learning_resources.html">QGIS Learning Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="teach_qgis.html">Teaching QGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Data Credits</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="performing_spatial_queries.html" title="Previous Chapter: Performing Spatial Queries"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Performing Spati...</span>
    </a>
  </li>
  <li>
    <a href="batch_processing.html" title="Next Chapter: Batch Processing using Processing Framework"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">Batch Processing... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><h3>Author</h3>
<p>Send me a message via my Google+ profile.</p>
<br>
<div class="g-person" data-width="200" data-href="//plus.google.com/116912222767108657277" data-theme="dark" data-showcoverphoto="true" data-rel="author"></div>
        </div>
      </div>
    <div class="col-md-9">
      

  <div class="section" id="nearest-neighbor-analysis">
<h1>Nearest Neighbor Analysis<a class="headerlink" href="#nearest-neighbor-analysis" title="Permalink to this headline">¶</a></h1>
<p>[ Download PDF <a class="reference external" href="../pdf/nearest_neighbor_analysis_a4.pdf">A4</a> <a class="reference external" href="../pdf/nearest_neighbor_analysis_letter.pdf">Letter</a> ]</p>
<p>GIS is very useful is analyzing spatial relationship between features. One such
analysis is finding out which features are closest to a given feature. QGIS has
a tool called <strong>Distance Matrix</strong> which helps with such analysis. In this
tutorial, we will use 2 datasets and find out which points from one layer are
closest to which point from the second layer.</p>
<div class="section" id="overview-of-the-task">
<h2>Overview of the task<a class="headerlink" href="#overview-of-the-task" title="Permalink to this headline">¶</a></h2>
<p>Given the locations of all known significant earthquakes, find out the nearest
populated place for each location where the earthquake happened.</p>
<div class="section" id="other-skills-you-will-learn">
<h3>Other skills you will learn<a class="headerlink" href="#other-skills-you-will-learn" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>How to do table joins in QGIS. (See <a class="reference internal" href="performing_table_joins.html"><em>Performing Table Joins</em></a> for
detailed instructions.)</li>
</ul>
</div>
</div>
<div class="section" id="get-the-data">
<h2>Get the data<a class="headerlink" href="#get-the-data" title="Permalink to this headline">¶</a></h2>
<p>We will use NOAA’s National Geophysical Data Center’s <a class="reference external" href="http://www.ngdc.noaa.gov/nndc/struts/form?t=101650&amp;s=1&amp;d=1">Significant Earthquake
Database</a> as our
layer represenging all major earthquakes. Download the <a class="reference external" href="http://www.ngdc.noaa.gov/nndc/struts/results?type_0=Exact&amp;query_0=$ID&amp;t=101650&amp;s=13&amp;d=189&amp;dfn=signif.txt">tab-delimited
earthquake data</a>.</p>
<p>Natural Earth has a nice <a class="reference external" href="http://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-populated-places/">Populated Places</a>
dataset. Download the <a class="reference external" href="http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_populated_places_simple.zip">simple (less columns) dataset</a></p>
<p>For convenience, you may directly download a copy of both the datasets from the links
below:</p>
<p><a class="reference download internal" href="../_downloads/signif.txt"><tt class="xref download docutils literal"><span class="pre">signif.txt</span></tt></a></p>
<p><a class="reference download internal" href="../_downloads/ne_10m_populated_places_simple.zip"><tt class="xref download docutils literal"><span class="pre">ne_10m_populated_places_simple.zip</span></tt></a></p>
<p>Data Sources: <a class="reference internal" href="credits.html#ngdc" id="id1">[NGDC]</a> <a class="reference internal" href="credits.html#naturalearth" id="id2">[NATURALEARTH]</a></p>
</div>
<div class="section" id="procedure">
<h2>Procedure<a class="headerlink" href="#procedure" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Open <em class="menuselection">Layer ‣ Add Delimited Text Layer</em> and browse to the
downloaded <tt class="docutils literal"><span class="pre">signif.txt</span></tt> file.</li>
</ol>
<img alt="../_images/149.png" class="align-center" src="../_images/149.png" />
<ol class="arabic simple" start="2">
<li>Since this is a <em>tab-delimited file</em>, choose <em class="guilabel">Tab</em> as the
<em class="guilabel">File format</em>. The <em class="guilabel">X field</em> and <em class="guilabel">Y field</em>
would be auto-populated. Click <em class="guilabel">OK</em>.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You may see some error messages as QGIS tries to import the file. These are
valid errors and some rows from the file will not be imported. You can ignore
the errors for the purpose of this tutorial.</p>
</div>
<img alt="../_images/218.png" class="align-center" src="../_images/218.png" />
<ol class="arabic simple" start="3">
<li>As the earthquake dataset has Latitude/Longitude coordinates, choose
<em class="guilabel">WGS 84 EPSG:436</em> as the CRS in the <em class="guilabel">Coordinate Reference System Selector</em>
dialog.</li>
</ol>
<img alt="../_images/315.png" class="align-center" src="../_images/315.png" />
<ol class="arabic simple" start="4">
<li>The earthquake point layer would now be loaded and displayed in QGIS. Let&#8217;s
also open the Populated Places layer. Go to <em class="menuselection">Layer ‣ Add
Vector Layer</em>.</li>
</ol>
<img alt="../_images/413.png" class="align-center" src="../_images/413.png" />
<ol class="arabic simple" start="5">
<li>Browse to the downloaded <tt class="docutils literal"><span class="pre">ne_10m_populated_places_simple.zip</span></tt> file and
click <em class="guilabel">Open</em>. Select the <tt class="docutils literal"><span class="pre">ne_10m_populated_places_simple.shp</span></tt> as
the layer in the <em class="guilabel">Select layers to add...</em> dialog.</li>
</ol>
<img alt="../_images/513.png" class="align-center" src="../_images/513.png" />
<ol class="arabic simple" start="6">
<li>Zoom around and explore both the datasets. Each purple point represents the
location of a significant earthquake and each blue point represents the
location of a populated place. We need a way to find out the nearest point
from the populated places layer for each of the points in the earthquake
layer.</li>
</ol>
<img alt="../_images/612.png" class="align-center" src="../_images/612.png" />
<ol class="arabic simple" start="7">
<li>Go to <em class="menuselection">Vector ‣ Analysis Tools ‣ Distance Matrix</em>.</li>
</ol>
<img alt="../_images/711.png" class="align-center" src="../_images/711.png" />
<ol class="arabic simple" start="8">
<li>Here select the earthquake layer <tt class="docutils literal"><span class="pre">signif</span></tt> as the Input point layer and the populated
places <tt class="docutils literal"><span class="pre">ne_10m_populated_places_simple</span></tt> as the target layer. You also need
to select a unique field from each of these layers which is how your results
will be displayed. In this analysis, we are looking to get only <strong>1</strong> nearest
point, so check the <em class="guilabel">Use only the nearest(k) target points</em>, and
enter <em class="guilabel">1</em>. Name your output file <tt class="docutils literal"><span class="pre">matrix.csv</span></tt>, and click OK.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A useful thing to note is that you can even perform the analysis with only 1
layer. Select the same layer as both Input and Target. The result would be a
nearest neighbor from the same layer instead of a different layer as we have
used here.</p>
</div>
<img alt="../_images/811.png" class="align-center" src="../_images/811.png" />
<ol class="arabic simple" start="9">
<li>Once your file is generated, you can view it in Notepad or any text editor.
QGIS can import CSV files as well, so we will add it to QGIS and view it
there. Go to <em class="menuselection">Layer ‣ Add Delimited Text Layer...</em>.</li>
</ol>
<img alt="../_images/910.png" class="align-center" src="../_images/910.png" />
<ol class="arabic simple" start="10">
<li>Browse to the newly created <tt class="docutils literal"><span class="pre">matrix.csv</span></tt> file. Since this file is just
text columns, select <em class="guilabel">No geometry (attribute only table)</em> as the
<em class="guilabel">Geometry definition</em>. Click <em class="guilabel">OK</em>.</li>
</ol>
<img alt="../_images/1010.png" class="align-center" src="../_images/1010.png" />
<ol class="arabic simple" start="11">
<li>You will the the CSV file loaded as a table. Right-click on the table layer
and select <em class="guilabel">Open Attribute Table</em>.</li>
</ol>
<img alt="../_images/1115.png" class="align-center" src="../_images/1115.png" />
<ol class="arabic simple" start="12">
<li>Now you will be able to see the content of our results. The <em class="guilabel">InputID</em>
field contains the field name from the Earthquake layer. The <em class="guilabel">TargetID</em>
field contains the name of the feature from the Populated Places layer that was
the closest to the earthquake point. The <em class="guilabel">Distance</em> field is the distance
between the 2 points.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Remember that the <em>distance</em> calculation will be done using the layers&#8217;
Coordinate Reference System. Here the distance will be in <em>decimal degrees</em>
units because our source layer coordinates are in degrees. If you want
distance in meters, reproject the layers before running the tool.</p>
</div>
<img alt="../_images/1212.png" class="align-center" src="../_images/1212.png" />
<ol class="arabic simple" start="13">
<li>This is very close to the result we were looking for. For some users, this
table would be sufficient. However, we can also integrate this results in
our original Earthquake layer using a <strong>Table Join</strong>. Right-click on the Earthquake
layer, and select <em class="guilabel">Properties</em>.</li>
</ol>
<img alt="../_images/1311.png" class="align-center" src="../_images/1311.png" />
<ol class="arabic simple" start="14">
<li>Go to the <em class="guilabel">Joins</em> tab and click on the <em class="guilabel">+</em> button.</li>
</ol>
<img alt="../_images/1410.png" class="align-center" src="../_images/1410.png" />
<ol class="arabic simple" start="15">
<li>We want to join the data from our analysis result (<tt class="docutils literal"><span class="pre">matrix.csv</span></tt>) to this
layer. We need to select a field from each of the layers that has the same
values. Select the fields as shown below.</li>
</ol>
<img alt="../_images/159.png" class="align-center" src="../_images/159.png" />
<ol class="arabic simple" start="16">
<li>You will see the join appear in the <em class="guilabel">Joins</em> tab. Click
<em class="guilabel">OK</em>.</li>
</ol>
<img alt="../_images/169.png" class="align-center" src="../_images/169.png" />
<ol class="arabic simple" start="17">
<li>Now open the attribute table of the Earthquakes layer by right-clicking and
selecting <em class="guilabel">Open Attribute Table</em>.</li>
</ol>
<img alt="../_images/178.png" class="align-center" src="../_images/178.png" />
<ol class="arabic simple" start="18">
<li>You will see that for every Earthquake feature, we now have an attribute
which is the nearest neighbor (closest populated place) and the distance to
the nearest neighbor.</li>
</ol>
<img alt="../_images/188.png" class="align-center" src="../_images/188.png" />
</div>
</div>



  <div id="disqus_thread"></div>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2013, Ujaval Gandhi.<br/>
      Last updated on May 13, 2014.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2.<br/>
    </p>
  </div>
</footer>
<!-- Google+ Badge -->
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>

<!-- Disqus comments widget -->
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'qgistutorials'; // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>

<script type="text/javascript">
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

  </body>
</html>